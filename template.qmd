---
# ------------------------------------------------------------------
# EXAMPLE DOCUMENT FOR THE 'academiccvtoolstemplate-typst' EXTENSION
#
# This document demonstrates how to use the Quarto extension to
# create a data-driven CV. All metadata and styling is set
# here in the YAML header, and the content is loaded from R.
# ------------------------------------------------------------------

# -- Basic Document Information ------------------------------------
title: "Documents of Application"
author:
  firstname: [Your Firstname]
  lastname: [Your Lastname]

# -- Contact & Social Media ----------------------------------------
# This information is used by the Typst template to build the
# sidebar/header. It expects a list of key-value pairs (maps).
#
# - icon: FontAwesome icon name (e.g., fa-envelope)
# - text: The text to display
# - url:  (Optional) A URL to link to (e.g., "mailto:..." or "https://...")
contact:
  - icon: fa address-card
    text: [Your Address]
  - icon: fa mobile-screen
    text: [Your Phone Number]
  - icon: fa envelope
    text: [Your E-Mail-Address]
    url: "mailto:your.email@gmail.com"
socialmedia: 
  - icon: fa house 
    text: example.com
    url: https://example.com
  - icon: fa orcid
    text: [Your Orcid Number]
    url: [Link To Your Orcid Page]
  - icon: fa github
    text: [Your GitHub Page]
    url: [Link To Your GitHub Page]
  - icon: fa linkedin
    text: LinkedIn
    url: [Link To Your LinkedIn Account]

# -- Core CV Content -----------------------------------------------
# These fields provide main content blocks to the template.
position: [Your Position] # Either your current position or the position you are applying for
profile-photo: [Path To Your Profile Picture] # Optional path to a photo
aboutme: |
  Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy 
  eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam 
  voluptua. At vero eos et accusam et justo duo dolores et ea rebum.
famous-quote: # Optional
  text: "Nothing is as practical as a good theory."
  attribution: "Kurt Lewin"

# -- Template Styling ----------------------------------------------
# These variables override the template defaults.
style:
  color-accent: "5e81ac" # A custom accent color (e.g., from Nord palette)
  font-header: "Lato"
  font-text: "Roboto"

# -- Format Activation ---------------------------------------------
# This is the most important line:
# It tells Quarto to use your custom Typst format.
format: academiccvtoolstemplate-typst
---

```{r}
#| label: lst-setup
#| include: false

# Load required libraries
library(tidyverse)       # For data manipulation (pipes, dplyr)
library(googledrive)     # To find the Google Sheet by name
library(googlesheets4)   # To read the Google Sheet data
library(academicCVtools) # The extension's R helper package

# --- Authentication -----------------------------------------------
# You must authenticate with Google to allow R to access your private sheets.
# This will open a browser window for you to log in the first time.
drive_auth()
gs4_auth(token = drive_token())

# --- Sheet Selection ----------------------------------------------
# Define which tabs (sheets) you want to load from your Google Sheet.
# The names here MUST match the tab names in your Google Sheet exactly.
cv_sheets_list <- list(
  "Working Experiences",
  "Education",
  "IT Skills", 
  "Language Skills",
  # You can rename a sheet if needed, e.g.:
  # "Raised Fundings" = "funds", 
  "Reviewer",
  "Institutional Services",
  "Research Interests",
  "Additional Academic Activity",
  "Teaching Experiences",
  "Training and Professional Development",
  "Other Employments",
  "Social Engagement",
  "Internships"
)

# --- Data Loading -------------------------------------------------
# The `load_cv_sheets` function finds your sheet and loads all the tabs
# defined in `cv_sheets_list` into a single R list named `cv_sheets`.
cv_sheets <- load_cv_sheets(
  # The name of your Google Sheet (must be unique in your Drive)
  doc_identifier = "Application_CV_Data", 
  
  # Use the list defined above.
  # Alternatively, use "*" to load ALL tabs from the sheet.
  sheets_to_load = cv_sheets_list 
)
```

## Research Interests

```{r}
#| output: asis
#| label: lst-research_interests

cv_sheets$research_interests |> 
  format_typst_section(
    # The name of the Typst function to call in your template
    typst_func = "#research-interests"
  ) |> 
  cat()
```

## Working Experiences

```{r}
#| output: asis
#| label: lst-work

cv_sheets$working_experiences |>
  format_typst_section(
    typst_func = "#resume-entry",
    
    # --- Data Combination ---
    # This is a powerful feature:
    # It finds all columns starting with "detail" (e.g., detail1, detail2)
    # and combines them into a single list column...
    combine_cols = c(dplyr::starts_with("detail")),
    # ...named "details".
    combine_as = "details",
    # This separator is added *between* combined items
    combine_sep = "\\ \\ ", # A Typst line break
    # This prefix is added *before* each item
    combine_prefix = "· ",
    
    # --- Column Exclusion ---
    # Exclude columns from the Google Sheet that the Typst function
    # doesn't need (e.g., sorting columns).
    exclude_cols = c(start, end)
  ) |> cat()
```

## Education

```{r}
#| output: asis
#| label: lst-education

# This is a simpler entry, without the `combine_cols` feature.
cv_sheets$education |>
  format_typst_section(
    typst_func = "#resume-entry", 
    exclude_cols = c(start, end)
  ) |> cat()
```

## Raised Fundings

```{r}
#| output: asis
#| label: lst-funds

cv_sheets$raised_fundings |>
format_typst_section(
  typst_func = "#resume-entry", 
  exclude_cols = c(start, end)
) |> cat()
```

## Publications List

```{r}
#| output: asis

create_publication_list(
  # Path to your BibTeX file
  bib_file = "_src/bibliography.bib", 
  # Your name as it appears in the .bib file (for highlighting)
  author_name = "Name, Your", 
  # CSL file for formatting citations
  csl_file = "_src/apa.csl",
  # Group publications by type (key = .bib type, value = Section Header)
  group_labels = c(
    article = "Journal Articles",
    inproceedings = "Conference Papers",
    incollection = "Book Chapters",
    misc = "In Preparation"
  ), 
  default_label = "Other",
  # Order of the groups in the final document
  group_order = c("Journal Article", "Book Chapter", "Conference Paper", "Miscellaneous"),
  # --- Typst Highlighting ---
  # This inserts raw Typst code to highlight your name
  author_highlight_markup = '#text(fill: rgb("516db0"), weight: "bold")[%s]'
) |> cat()
```

## Institutional Services

```{r}
#| output: asis
#| label: lst-institute

cv_sheets$institutional_services |>
  format_typst_section(
    typst_func = "#resume-entry", 
    exclude_cols = c(start, end)
  ) |> cat()
```

## Additional Academic Activity

```{r}
#| output: asis
#| label: lst-activity

cv_sheets$additional_academic_activity |>
  format_typst_section(
    typst_func = "#resume-entry",
    combine_cols = c(dplyr::starts_with("detail")),
    combine_as = "details",
    combine_sep = "\\ \\ ",
    combine_prefix = "· ",
    exclude_cols = c(start, end)
  ) |> cat()
```

## Teaching Experiences

```{r}
#| output: asis
#| label: lst-teaching

cv_sheets$teaching_experiences |>
  format_typst_section(
    typst_func = "#resume-entry", 
    exclude_cols = c(start, end)
  ) |> cat()
```

## Training and Professional Development

```{r}
#| output: asis
#| label: lst-training

cv_sheets$training_and_professional_development |>
  format_typst_section(
    typst_func = "#resume-entry",
    combine_cols = c(dplyr::starts_with("detail")),
    combine_as = "details",
    combine_sep = "\\ \\ ",
    combine_prefix = "· ",
    exclude_cols = c(start, end)
  ) |> cat()
```

## Internships

```{r}
#| output: asis
#| label: lst-internships

cv_sheets$internships |>
  format_typst_section(
    typst_func = "#resume-entry",
    combine_cols = c(dplyr::starts_with("detail")),
    combine_as = "details",
    combine_sep = "\\ \\ ",
    combine_prefix = "· ",
    exclude_cols = c(start, end)
  ) |> cat()
```

## Reviewer

```{r}
#| output: asis
#| label: lst-reviewer

cv_sheets$reviewer |>
  format_typst_section(
    typst_func = "#resume-entry",
    combine_cols = c(starts_with("detail")), 
    combine_as = "details", 
    combine_prefix = "· "
  ) |> cat()
```

## Social Engagement

```{r}
#| output: asis
#| label: lst-social

cv_sheets$social_engagement |>
  format_typst_section(
    typst_func = "#resume-entry",
    combine_cols = c(dplyr::starts_with("detail")),
    combine_as = "details",
    combine_sep = "\\ \\ ",
    combine_prefix = "· ",
    exclude_cols = c(start, end)
  ) |> cat()
```

## Language Skills

```{r}
#| output: asis
#| label: lst-language

cv_sheets$language_skills |>
  format_typst_section(
    # This Typst function expects an array, not a dictionary
    typst_func = "#visualize-skills-list",
    # This mode formats the data as a Typst array: `("val1", "val2", ...)`
    output_mode = "array"
  ) |> cat()
```

## Tech Stack

```{r}
#| output: asis
#| label: lst-tech

cv_sheets$it_skills |>
  format_typst_section(
    typst_func = "#visualize-skills-list",
    output_mode = "array"
  ) |> cat()
```

## Employments

```{r}
#| output: asis
#| label: lst-other

cv_sheets$other_employments |>
  format_typst_section(
    typst_func = "#resume-entry",
    combine_cols = c(dplyr::starts_with("detail")),
    combine_as = "details",
    combine_sep = "\\ \\ ",
    combine_prefix = "· ",
    exclude_cols = c(start, end)
  ) |> cat()
```
